Ext.define("CAST.Events",{extend:"Ext.util.Observable",singleton:!0,showInfoWindow:function(a){Ext.Msg.show({title:"Success!",msg:a,icon:Ext.Msg.INFO,buttons:Ext.Msg.OK})},showCautionWindow:function(a){Ext.Msg.show({title:"Caution!",msg:a,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})}});Ext.ns("CAST","CAST.Controllers");CAST.Controllers=["CAST.controller.index.CastList","CAST.controller.edit.CastForm"];Ext.define("Ext.ux.form.SearchField",{extend:"Ext.form.field.Trigger",alias:"widget.searchfield",trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",trigger2Cls:Ext.baseCSSPrefix+"form-search-trigger",hasSearch:!1,paramName:"query",initComponent:function(){var a=this;a.callParent(arguments);a.on("specialkey",function(c,b){if(b.getKey()==b.ENTER)a.onTrigger2Click()});a.store.remoteFilter=!0;if(!a.store.proxy.hasOwnProperty("filterParam"))a.store.proxy.filterParam=a.paramName;a.store.proxy.encodeFilters=
function(a){return a[0].value}},afterRender:function(){this.callParent();this.triggerCell.item(0).setDisplayed(!1)},onTrigger1Click:function(){if(this.hasSearch)this.setValue(""),this.store.clearFilter(),this.hasSearch=!1,this.triggerCell.item(0).setDisplayed(!1),this.updateLayout()},onTrigger2Click:function(){var a=this.getValue();if(0<a.length)this.store.filter({id:this.paramName,property:this.paramName,value:a}),this.hasSearch=!0,this.triggerCell.item(0).setDisplayed(!0),this.updateLayout()}});Ext.define("CAST.controller.index.CastList",{extend:"Ext.app.Controller",refs:[{ref:"List",selector:"index-CastList"}],init:function(){var a=this;a.control({"index-CastList":{itemcontextmenu:function(c,b,d,f,e){c=Ext.create("Ext.menu.Menu",{items:[{text:"is_active\u306e\u66f4\u65b0",handler:function(){a.updateIsActive(b)}}]});e.stopEvent();c.showAt(e.getXY())},itemclick:function(a,b){window.open("/index/edit/cast_id/"+b.raw.cast_id)}}})},updateIsActive:function(a){var c=this;Cast.updateIsActive({id:a.raw.id},
function(){c.getList().getStore().reload()})}});Ext.define("CAST.controller.edit.CastForm",{extend:"Ext.app.Controller",refs:[{ref:"Form",selector:"edit-CastForm"},{ref:"List",selector:"edit-CastList"}],init:function(){var a=this;a.control({"edit-CastList":{select:function(c,b){var d=a.getForm();d.getForm().load({params:{id:b.raw.id},success:function(){d.down('button[action="new"]').enable();d.down('button[action="update"]').enable();d.down('button[action="delete"]').enable()}})}},'edit-CastForm button[action="new"]':{click:a.createSubmit},'edit-CastForm button[action="update"]':{click:a.updateSubmit},
'edit-CastForm button[action="delete"]':{click:a.deleteSubmit}})},createSubmit:function(a){var c=this,b=c.getForm();b.getForm().isValid()&&(a.disable(),b=b.getValues(),Cast.createCastData({values:b},function(b){a.enable();c.callback(b)}))},updateSubmit:function(a){var c=this,b=c.getForm();b.getForm().isValid()&&(a.disable(),b=b.getValues(),Cast.updateCastData({values:b},function(b){a.enable();c.callback(b)}))},deleteSubmit:function(a){var c=this,b=c.getForm();Ext.Msg.confirm("Confirm","\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f",
function(d){"yes"==d&&(a.disable(),Cast.deleteCastData({id:b.getValues().id},function(b){a.enable();c.callback(b)}))})},callback:function(a){a.success?this.getList().getStore().reload():Ext.Msg.show({title:"Caution!",msg:a.msg,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})}});Ext.define("CAST.view.index.CastList",{extend:"Ext.grid.Panel",alias:"widget.index-CastList",requires:["Ext.ux.form.SearchField"],initComponent:function(){this.buildStore();this.buildColumns();this.buildToolbar();Ext.apply(this,{multiSelect:!0,height:600});this.callParent(arguments)},buildStore:function(){this.store=Ext.create("Ext.data.Store",{autoLoad:!0,pageSize:300,fields:"id,cast_id,dmm_name,name,furigana,search_index,is_active".split(","),proxy:{type:"direct",directFn:Cast.getList,reader:{root:"results",
totalProperty:"count"}}})},buildColumns:function(){this.columns=[{text:"id",dataIndex:"id",flex:0.5},{text:"cast_id",dataIndex:"cast_id",flex:0.5},{text:"dmm_name",dataIndex:"dmm_name",flex:1},{text:"name",dataIndex:"name",flex:1},{text:"furigana",dataIndex:"furigana",flex:1},{text:"search_index",dataIndex:"search_index",flex:0.5},{text:"is_active",dataIndex:"is_active",flex:0.5}]},buildToolbar:function(){this.tbar=[{xtype:"searchfield",store:this.store,width:400}];this.bbar=Ext.create("Ext.PagingToolbar",
{store:this.store})}});Ext.define("CAST.view.edit.CastForm",{extend:"Ext.form.Panel",alias:"widget.edit-CastForm",paramsAsHash:!0,bodyStyle:"padding: 30px;",defaults:{xtype:"textfield",width:500,allowBlank:!1},initComponent:function(){this.items=[];this.buildHiddenFields();this.buildDmmName();this.buildName();this.buildFurigana();this.buildDMMButton();Ext.apply(this,{buttons:[{text:"\u65b0\u898f\u4f5c\u6210",action:"new",disabled:!0},{text:"\u30c7\u30fc\u30bf\u66f4\u65b0",action:"update",disabled:!0},{text:"\u30c7\u30fc\u30bf\u524a\u9664",
action:"delete",disabled:!0}]});this.callParent(arguments)},buildHiddenFields:function(){this.items.push({xtype:"hidden",name:"id",allowBlank:!0},{xtype:"hidden",name:"cast_id",allowBlanks:!0})},buildDmmName:function(){this.items.push({name:"dmm_name",readOnly:!0,fieldLabel:"DmmName"})},buildName:function(){this.items.push({name:"name",fieldLabel:"Name",selectOnFocus:!0})},buildFurigana:function(){this.items.push({name:"furigana",fieldLabel:"furigana",selectOnFocus:!0})},buildDMMButton:function(){var a=
this;a.items.push({xtype:"button",text:"DMM",style:"margin-top: 20px;",width:120,handler:function(){window.open("http://actress.dmm.co.jp/-/detail/=/actress_id="+a.cast_id+"/")}})}});Ext.Loader.setConfig({enabled:!0,paths:{Ext:"/ext/src","Ext.ux":"/src/ux",CAST:"/src/app"}});Ext.application({controllers:CAST.Controllers,launch:function(){if(Ext.get("render-list-container"))Ext.create("CAST.view.index.CastList",{renderTo:"render-list-container"});else if(Ext.get("render-edit-form-container")){var a=Ext.get("render-edit-form-container");Ext.create("CAST.view.edit.Panel",{renderTo:"render-edit-form-container",cast_id:a.getAttribute("cast_id")})}}});
